<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ResumeLens</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
            color: #1f2937;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
            padding: 2rem;
        }

        .hero-section {
            background: #ffffff;
            padding: 4rem 2rem;
            border-radius: 1rem;
            text-align: center;
        }

        .section-heading {
            background: -webkit-linear-gradient(45deg, #2563eb, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 700;
        }

        .card {
            background-color: #ffffff;
            border: 1px solid #e5e7eb;
        }

        .button-primary {
            background-color: #2563eb;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(37, 99, 235, 0.2);
        }

        .button-primary:hover {
            background-color: #3b82f6;
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(37, 99, 235, 0.3);
        }

        .tab-button {
            transition: all 0.3s ease;
        }

        .tab-button.active {
            color: #2563eb;
            border-bottom-width: 2px;
            border-color: #2563eb;
        }


        #match_score_bar_container {
            background-color: #e5e7eb;
        }

        #match_score_bar {
            transition: width 0.5s ease-in-out;
            background: linear-gradient(90deg, #2563eb, #8b5cf6);
        }

        #missing_skills_list li::before {
            content: "â€¢";
            color: #ef4444;
            font-weight: bold;
            display: inline-block;
            width: 1em;
            margin-left: -1em;
        }

        .icon-gradient {
            background: -webkit-linear-gradient(45deg, #6c4af5, #9b5ae7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
    </style>
</head>

<body class="bg-[#f8fafc] text-[#1f2937]">

    <header class="py-6 border-b border-[#e5e7eb]">
        <div class="container flex flex-col md:flex-row justify-between items-center">
            <h1 class="text-3xl font-bold section-heading mb-4 md:mb-0">ResumeLens</h1>
            <nav class="flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-8">
                <a href="#home" class="hover:text-blue-500 transition-colors">Home</a>
                <a href="#services" class="hover:text-blue-500 transition-colors">Services</a>
                <a href="#about" class="hover:text-blue-500 transition-colors">About</a>
                <a href="#" class="hover:text-blue-500 transition-colors">Contact</a>
            </nav>
        </div>
    </header>

    <main class="container py-8">
        <section id="home" class="hero-section mb-12">
            <h2 class="text-4xl md:text-5xl font-extrabold section-heading mb-4">Elevate Your Career with AI</h2>
            <p class="text-lg text-gray-600 max-w-2xl mx-auto mb-8">
                Our AI-driven platform helps candidates evaluate their resumes and recruiters find the perfect match.
            </p>
            <div class="flex justify-center space-x-4">
                <a href="#"
                    class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-full transition-colors">Candidate</a>
                <a href="#"
                    class="bg-gray-700 hover:bg-gray-600 text-white font-semibold py-3 px-6 rounded-full transition-colors">Recruiter</a>
            </div>
        </section>

        <section id="main-content" class="bg-white p-8 rounded-lg shadow-xl border border-[#e5e7eb]">
            <div class="flex justify-center mb-8">
                <button id="candidate-tab"
                    class="tab-button text-lg font-semibold px-4 py-2 border-b-2 border-transparent active">Candidate</button>
                <button id="recruiter-tab"
                    class="tab-button text-lg font-semibold px-4 py-2 border-b-2 border-transparent ml-4">Recruiter</button>
            </div>

            <div id="candidate-section" class="tab-content">
                <div class="flex flex-col md:flex-row gap-8 mb-8">
                    <div class="w-full md:w-1/2">
                        <label for="resume_file" class="block text-lg font-medium mb-2">Upload Your Resume (PDF)</label>
                        <input type="file" id="resume_file" accept=".pdf"
                            class="block w-full text-sm text-gray-500 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-600 file:text-white hover:file:bg-blue-700 transition-colors">
                    </div>
                    <div class="w-full md:w-1/2">
                        <label for="job_desc" class="block text-lg font-medium mb-2">Paste Job Description</label>
                        <textarea id="job_desc" rows="6"
                            class="w-full p-3 rounded-lg bg-gray-50 border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:outline-none placeholder-gray-400"></textarea>
                    </div>
                </div>
                <button id="analyze_btn"
                    class="w-full md:w-auto px-8 py-3 rounded-lg text-white font-semibold button-primary">Analyze
                    Resume</button>

                <div id="loading_status" class="hidden mt-6 text-center text-blue-500 animate-pulse">
                    <i class="fas fa-spinner fa-spin mr-2"></i>
                    <p>Analyzing your resume...</p>
                </div>

                <div id="results_section" class="hidden mt-8 p-6 card rounded-lg shadow-lg">
                    <h3 class="text-2xl font-bold section-heading mb-4">Your Analysis Report</h3>

                    <div class="mb-6">
                        <h4 class="text-lg font-semibold mb-2">Skill Match Score</h4>
                        <div id="match_score_bar_container" class="w-full h-8 rounded-full overflow-hidden">
                            <div id="match_score_bar"
                                class="h-full rounded-full flex items-center justify-end pr-4 text-white font-bold"
                                style="width: 0%;">
                                <span id="match_score_percentage">0%</span>
                            </div>
                        </div>
                    </div>

                    <div class="mb-6">
                        <h4 class="text-lg font-semibold mb-2">Missing Skills</h4>
                        <div id="missing_skills_list" class="flex flex-wrap gap-2"></div>
                        <p id="no_missing_skills" class="hidden text-green-600"><i
                                class="fas fa-check-circle mr-2"></i>You have all the required skills!</p>
                    </div>

                    <div class="mb-6">
                        <h4 class="text-lg font-semibold mb-2">Recommended Job Roles</h4>
                        <div id="recommended_jobs_container" class="text-gray-600"></div>
                    </div>

                    <div class="text-center">
                        <button id="cover_letter_btn"
                            class="px-8 py-3 rounded-lg text-white font-semibold button-primary">Generate Cover
                            Letter</button>
                        <div id="cover_letter_status" class="hidden mt-4 text-center text-blue-500 animate-pulse">
                            <i class="fas fa-spinner fa-spin mr-2"></i>
                            <p>Generating your personalized cover letter...</p>
                        </div>
                        <div id="cover_letter_container" class="hidden mt-6">
                            <textarea id="cover_letter_text" rows="15"
                                class="w-full p-4 rounded-lg bg-gray-50 border border-gray-300 text-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                            <button onclick="copyToClipboard()"
                                class="mt-4 px-6 py-2 rounded-lg bg-gray-700 hover:bg-gray-600 text-white transition-colors">
                                <i class="fas fa-copy mr-2"></i>Copy to Clipboard
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="recruiter-section" class="tab-content hidden p-8 card rounded-lg shadow-lg">
                <h3 class="text-2xl font-bold section-heading mb-4">Candidate Analyzer</h3>
                <div class="flex flex-col md:flex-row gap-8 mb-8">
                    <div class="w-full md:w-1/2">
                        <label for="resumes_files" class="block text-lg font-medium mb-2">Upload Resumes (PDFs)</label>
                        <input type="file" id="resumes_files" accept=".pdf" multiple
                            class="block w-full text-sm text-gray-500 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-600 file:text-white hover:file:bg-blue-700 transition-colors">
                    </div>
                    <div class="w-full md:w-1/2">
                        <label for="recruiter_job_desc" class="block text-lg font-medium mb-2">Paste Job
                            Description</label>
                        <textarea id="recruiter_job_desc" rows="6"
                            class="w-full p-3 rounded-lg bg-gray-50 border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:outline-none placeholder-gray-400"></textarea>
                    </div>
                </div>
                <button id="recruiter_analyze_btn"
                    class="w-full md:w-auto px-8 py-3 rounded-lg text-white font-semibold button-primary">Analyze
                    Candidates</button>

                <div id="recruiter_loading_status" class="hidden mt-6 text-center text-blue-500 animate-pulse">
                    <i class="fas fa-spinner fa-spin mr-2"></i>
                    <p>Analyzing candidates...</p>
                </div>

                <div id="recruiter_results_section" class="hidden mt-8 p-6 card rounded-lg shadow-lg">
                    <h4 class="text-2xl font-bold section-heading mb-4">Candidate Ranking & Reports</h4>
                    <div class="mb-8 flex justify-center">
                        <div class="relative" style="width: 40rem; height: 20rem;">
                            <h5 class="text-xl font-semibold mb-4 text-center">Candidate Match Score Comparison</h5>
                            <canvas id="candidate_chart"></canvas>
                        </div>
                    </div>
                    <div id="recruiter_results_container" class="space-y-4">
                        <script>
                            document.addEventListener('DOMContentLoaded', () => {
                                // ... (rest of the JavaScript)
                                recruiterAnalyzeBtn.addEventListener('click', async () => {
                                    // ... (rest of the analyze function)

                                    if (data.candidates && data.candidates.length > 0) {
                                        // ... (rest of the chart and loop logic)

                                        data.candidates.forEach(candidate => {
                                            const card = document.createElement('div');
                                            card.classList.add('card', 'p-6', 'rounded-lg', 'shadow-md', 'mb-4');

                                            let missingSkillsHtml = candidate.missing_skills.length > 0
                                                ? `<div class="flex flex-wrap gap-2">${candidate.missing_skills.map(skill => `<span class="bg-red-100 text-red-800 text-xs font-medium px-2.5 py-0.5 rounded-full"><i class="fas fa-times-circle mr-1"></i>${skill}</span>`).join('')}</div>`
                                                : '<p class="text-green-600"><i class="fas fa-check-circle mr-2"></i>Candidate has all required skills.</p>';

                                            card.innerHTML = `
        <div class="flex flex-col md:flex-row justify-between items-start mb-4">
            <div class="flex-grow">
                <h5 class="text-2xl font-bold section-heading">${candidate.name || 'Unknown Candidate'}</h5>
                <p class="text-gray-600"><i class="fas fa-envelope mr-2"></i>Email: ${candidate.email || 'N/A'}</p>
                <p class="text-gray-600"><i class="fas fa-phone mr-2"></i>Phone: ${candidate.phone || 'N/A'}</p>
            </div>
            <div class="flex-shrink-0 mt-4 md:mt-0 md:ml-4 text-center">
                <span class="text-4xl font-extrabold text-blue-600 block">${candidate.match_percentage}% Match</span>
                <img src="data:image/png;base64,${candidate.pie_chart}" alt="Match Pie Chart" class="w-28 h-28 mt-2 mx-auto object-contain">
            </div>
        </div>
        <div class="mb-4">
            <h6 class="font-semibold text-lg">Missing Skills:</h6>
            ${missingSkillsHtml}
        </div>
    `;
                                            recruiterResultsContainer.appendChild(card);
                                        });
                                    } else {
                                        // ... (rest of the code)
                                    }
                                });
                                // ... (rest of the JavaScript)
                            });
                        </script>
                    </div>
                </div>
            </div>
        </section>

        <section id="services" class="container py-12">
            <h2 class="text-4xl font-extrabold text-center section-heading mb-12">Our Services</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                <div class="card p-8 rounded-lg shadow-lg flex flex-col items-start space-y-4">
                    <i class="fas fa-chart-line text-4xl icon-gradient"></i>
                    <h4 class="text-xl font-semibold section-heading">Resume Analysis</h4>
                    <p class="text-gray-600">The platform analyzes a candidate's resume and a specific job description
                        to determine the percentage of skills that match.</p>
                </div>

                <div class="card p-8 rounded-lg shadow-lg flex flex-col items-start space-y-4">
                    <i class="fas fa-crosshairs text-4xl icon-gradient"></i>
                    <h4 class="text-xl font-semibold section-heading">Skill Gap Identification</h4>
                    <p class="text-gray-600">It highlights the skills a candidate is missing for a particular job,
                        helping them understand where they need to improve.</p>
                </div>

                <div class="card p-8 rounded-lg shadow-lg flex flex-col items-start space-y-4">
                    <i class="fas fa-lightbulb text-4xl icon-gradient"></i>
                    <h4 class="text-xl font-semibold section-heading">Job Recommendations</h4>
                    <p class="text-gray-600">Based on the candidate's existing skill set, the platform suggests other
                        relevant job positions they may be a good fit for.</p>
                </div>

                <div class="card p-8 rounded-lg shadow-lg flex flex-col items-start space-y-4">
                    <i class="fas fa-chart-pie text-4xl icon-gradient"></i>
                    <h4 class="text-xl font-semibold section-heading">Visual Reports</h4>
                    <p class="text-gray-600">Candidates can see their results presented in charts and with other
                        insights.</p>
                </div>

                <div class="card p-8 rounded-lg shadow-lg flex flex-col items-start space-y-4">
                    <i class="fas fa-upload text-4xl icon-gradient"></i>
                    <h4 class="text-xl font-semibold section-heading">Bulk Resume Processing</h4>
                    <p class="text-gray-600">Recruiters can upload multiple resumes at once to streamline the screening
                        process.</p>
                </div>

                <div class="card p-8 rounded-lg shadow-lg flex flex-col items-start space-y-4">
                    <i class="fas fa-robot text-4xl icon-gradient"></i>
                    <h4 class="text-xl font-semibold section-heading">AI-Powered Matching</h4>
                    <p class="text-gray-600">The system uses AI to extract skills from resumes and calculate a "Match
                        Score" for each candidate against a specific job description.</p>
                </div>

                <div class="card p-8 rounded-lg shadow-lg flex flex-col items-start space-y-4">
                    <i class="fas fa-sort-amount-down text-4xl icon-gradient"></i>
                    <h4 class="text-xl font-semibold section-heading">Candidate Ranking and Visualization</h4>
                    <p class="text-gray-600">A dashboard visually ranks all candidates based on their Match Score,
                        making it easy to see the most suitable applicants at a glance.</p>
                </div>

                <div class="card p-8 rounded-lg shadow-lg flex flex-col items-start space-y-4">
                    <i class="fas fa-file-download text-4xl icon-gradient"></i>
                    <h4 class="text-xl font-semibold section-heading">Downloadable Reports</h4>
                    <p class="text-gray-600">Recruiters can download structured reports containing detailed information,
                        including candidate contact details, matched skills, and missing skills.</p>
                </div>
            </div>
        </section>

        <footer class="py-6 mt-12 border-t border-[#e5e7eb] text-center text-sm text-gray-500">
            <p>&copy; 2024 AI-Powered Career Platform. All Rights Reserved.</p>
        </footer>

        <script>
            document.addEventListener('DOMContentLoaded', () => {
                const analyzeBtn = document.getElementById('analyze_btn');
                const coverLetterBtn = document.getElementById('cover_letter_btn');
                const resumeFile = document.getElementById('resume_file');
                const jobDesc = document.getElementById('job_desc');
                const loadingStatus = document.getElementById('loading_status');
                const resultsSection = document.getElementById('results_section');
                const matchScoreBar = document.getElementById('match_score_bar');
                const matchScorePercentage = document.getElementById('match_score_percentage');
                const missingSkillsList = document.getElementById('missing_skills_list');
                const noMissingSkills = document.getElementById('no_missing_skills');
                const recommendedJobsContainer = document.getElementById("recommended_jobs_container");
                const coverLetterStatus = document.getElementById('cover_letter_status');
                const coverLetterContainer = document.getElementById('cover_letter_container');
                const coverLetterTextarea = document.getElementById('cover_letter_text');
                const recruiterAnalyzeBtn = document.getElementById('recruiter_analyze_btn');
                const recruiterLoadingStatus = document.getElementById('recruiter_loading_status');
                const recruiterResultsSection = document.getElementById('recruiter_results_section');
                const recruiterResultsContainer = document.getElementById('recruiter_results_container');
                const resumesFiles = document.getElementById('resumes_files');
                const recruiterJobDesc = document.getElementById('recruiter_job_desc');
                const candidateChartCanvas = document.getElementById('candidate_chart');
                let candidateChart = null;
                const candidateTab = document.getElementById('candidate-tab');
                const recruiterTab = document.getElementById('recruiter-tab');
                const candidateSection = document.getElementById('candidate-section');
                const recruiterSection = document.getElementById('recruiter-section');

                let resumeSkills = '';
                let jobDescText = '';

                // START OF NEW CODE TO ADD
                // Get the candidate and recruiter buttons from the hero section
                const heroCandidateBtn = document.querySelector('.hero-section .bg-blue-600');
                const heroRecruiterBtn = document.querySelector('.hero-section .bg-gray-700');

                // Add event listeners to the hero buttons
                heroCandidateBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    candidateTab.click();
                    document.getElementById('main-content').scrollIntoView({ behavior: 'smooth' });
                });

                heroRecruiterBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    recruiterTab.click();
                    document.getElementById('main-content').scrollIntoView({ behavior: 'smooth' });
                });
                // END OF NEW CODE TO ADD

                // Tab switching logic
                candidateTab.addEventListener('click', () => {
                    candidateTab.classList.add('active');
                    recruiterTab.classList.remove('active');
                    candidateSection.classList.remove('hidden');
                    recruiterSection.classList.add('hidden');
                });

                recruiterTab.addEventListener('click', () => {
                    recruiterTab.classList.add('active');
                    candidateTab.classList.remove('active');
                    recruiterSection.classList.remove('hidden');
                    candidateSection.classList.add('hidden');
                });

                analyzeBtn.addEventListener('click', async () => {
                    const file = resumeFile.files[0];
                    jobDescText = jobDesc.value;

                    if (!file || !jobDescText) {
                        displayMessage('Please upload a resume and paste a job description.', 'error');
                        return;
                    }

                    loadingStatus.classList.remove('hidden');
                    resultsSection.classList.add('hidden');

                    const formData = new FormData();
                    formData.append('resume', file);
                    formData.append('job_desc', jobDescText);

                    try {
                        const response = await fetch('/analyze', {
                            method: 'POST',
                            body: formData
                        });

                        if (!response.ok) {
                            const errorData = await response.json();
                            throw new Error(errorData.error || 'Something went wrong during analysis.');
                        }

                        const data = await response.json();

                        const score = data.match_percentage;
                        matchScorePercentage.textContent = `${score}%`;
                        matchScoreBar.style.width = `${score}%`;

                        // Clear previous results
                        missingSkillsList.innerHTML = "";
                        recommendedJobsContainer.innerHTML = "";

                        // Populate Missing Skills
                        if (data.missing_skills && data.missing_skills.length > 0) {
                            noMissingSkills.classList.add('hidden');
                            // Generate the HTML for the horizontal skills list
                            const skillsHtml = data.missing_skills.map(skill =>
                                `<span class="bg-red-100 text-red-800 text-xs font-medium px-2.5 py-0.5 rounded-full"><i class="fas fa-times-circle mr-1"></i>${skill}</span>`
                            ).join('');
                            missingSkillsList.innerHTML = skillsHtml;
                        } else {
                            noMissingSkills.classList.remove('hidden');
                            missingSkillsList.innerHTML = ""; // Clear any previous content
                        }

                        // Populate Recommended Jobs
                        if (data.recommended_jobs && Object.keys(data.recommended_jobs).length > 0) {
                            for (const [level, roles] of Object.entries(data.recommended_jobs)) {
                                const section = document.createElement("div");
                                section.innerHTML = `
                          <h5 class="text-md font-semibold mt-4 mb-2">${level.toUpperCase()} Roles:</h5>
                          <ul class="list-disc list-inside space-y-1">
                            ${roles.map(r => `<li>${r}</li>`).join("")}
                          </ul>
                        `;
                                recommendedJobsContainer.appendChild(section);
                            }
                        } else {
                            recommendedJobsContainer.innerHTML = "<p>No recommendations available.</p>";
                        }

                        // Store skills for cover letter generation
                        resumeSkills = data.resume_skills;
                        jobDescText = data.job_skills;

                        loadingStatus.classList.add('hidden');
                        resultsSection.classList.remove('hidden');

                    } catch (error) {
                        loadingStatus.classList.add('hidden');
                        displayMessage(`Error: ${error.message}`, 'error');
                        console.error('Error:', error);
                    }
                });

                coverLetterBtn.addEventListener('click', async () => {
                    if (!resumeSkills || !jobDescText) {
                        displayMessage('Please analyze your resume first.', 'error');
                        return;
                    }

                    coverLetterStatus.classList.remove('hidden');
                    coverLetterContainer.classList.add('hidden');

                    try {
                        const response = await fetch('/generate-cover-letter', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                resume_skills: resumeSkills,
                                job_desc: jobDescText
                            })
                        });

                        if (!response.ok) {
                            const errorData = await response.json();
                            throw new Error(errorData.error || 'Failed to generate cover letter.');
                        }

                        const data = await response.json();
                        coverLetterTextarea.value = data.cover_letter;

                        coverLetterStatus.classList.add('hidden');
                        coverLetterContainer.classList.remove('hidden');

                    } catch (error) {
                        coverLetterStatus.classList.add('hidden');
                        displayMessage(`Error: ${error.message}`, 'error');
                        console.error('Error:', error);
                    }
                });

                recruiterAnalyzeBtn.addEventListener('click', async () => {
                    const files = resumesFiles.files;
                    const recruiterJobDescText = recruiterJobDesc.value;

                    if (files.length === 0 || !recruiterJobDescText) {
                        displayMessage('Please upload one or more resumes and paste a job description.', 'error');
                        return;
                    }

                    recruiterLoadingStatus.classList.remove('hidden');
                    recruiterResultsSection.classList.add('hidden');
                    recruiterResultsContainer.innerHTML = ''; // Clear previous results

                    const formData = new FormData();
                    formData.append('job_desc', recruiterJobDescText);
                    for (const file of files) {
                        formData.append('resumes[]', file);
                    }

                    try {
                        const response = await fetch('/analyze-recruiter', {
                            method: 'POST',
                            body: formData
                        });

                        if (!response.ok) {
                            const errorData = await response.json();
                            throw new Error(errorData.error || 'Something went wrong during analysis.');
                        }

                        const data = await response.json();

                        if (data.candidates && data.candidates.length > 0) {
                            // Create chart data
                            const candidateNames = data.candidates.map(c => c.name || c.pdf_name.split('.')[0]);
                            const matchScores = data.candidates.map(c => c.match_percentage);

                            // If a chart instance exists, destroy it to redraw
                            if (candidateChart) {
                                candidateChart.destroy();
                            }

                            // New Chart.js logic
                            const ctx = candidateChartCanvas.getContext('2d');
                            candidateChart = new Chart(ctx, {
                                type: 'bar',
                                data: {
                                    labels: candidateNames,
                                    datasets: [{
                                        label: 'Match Score (%)',
                                        data: matchScores,
                                        backgroundColor: '#2563eb', // Blue
                                        borderColor: '#1e40af',
                                        borderWidth: 1
                                    }]
                                },
                                options: {
                                    responsive: true,
                                    maintainAspectRatio: false,
                                    scales: {
                                        y: {
                                            beginAtZero: true,
                                            max: 100,
                                            title: {
                                                display: true,
                                                text: 'Match Score (%)'
                                            }
                                        }
                                    }
                                }
                            });


                            data.candidates.forEach(candidate => {
                                const card = document.createElement('div');
                                card.classList.add('card', 'p-6', 'rounded-lg', 'shadow-md', 'mb-4');

                                let missingSkillsHtml = candidate.missing_skills.length > 0
                                    ? `<div class="flex flex-wrap gap-2">${candidate.missing_skills.map(skill => `<span class="bg-red-100 text-red-800 text-xs font-medium px-2.5 py-0.5 rounded-full"><i class="fas fa-times-circle mr-1"></i>${skill}</span>`).join('')}</div>`
                                    : '<p class="text-green-600"><i class="fas fa-check-circle mr-2"></i>Candidate has all required skills.</p>';

                                card.innerHTML = `
                                <div class="flex flex-col md:flex-row justify-between items-start mb-4">
                                    <div class="flex-grow">
                                        <h5 class="text-2xl font-bold section-heading">${candidate.name || 'Unknown Candidate'}</h5>
                                        <p class="text-gray-600"><i class="fas fa-envelope mr-2"></i>Email: ${candidate.email || 'N/A'}</p>
                                        <p class="text-gray-600"><i class="fas fa-phone mr-2"></i>Phone: ${candidate.phone || 'N/A'}</p>
                                    </div>
                                    <div class="flex-shrink-0 mt-4 md:mt-0 md:ml-4 text-center">
                                        <span class="text-4xl font-extrabold text-blue-600 block">${candidate.match_percentage}% Match</span>
                                        <img src="data:image/png;base64,${candidate.pie_chart}" alt="Match Pie Chart" class="w-28 h-28 mt-2 mx-auto object-contain">
                                    </div>
                                </div>
                                <div class="mb-4">
                                    <h6 class="font-semibold text-lg">Missing Skills:</h6>
                                    ${missingSkillsHtml}
                                </div>
                            `;
                                recruiterResultsContainer.appendChild(card);
                            });
                        } else {
                            recruiterResultsContainer.innerHTML = `<p class="text-gray-500 text-center">No candidates found with a valid resume match.</p>`;
                        }

                        recruiterLoadingStatus.classList.add('hidden');
                        recruiterResultsSection.classList.remove('hidden');

                    } catch (error) {
                        recruiterLoadingStatus.classList.add('hidden');
                        displayMessage(`Error: ${error.message}`, 'error');
                        console.error('Error:', error);
                    }
                });

                function copyToClipboard() {
                    const textarea = document.getElementById('cover_letter_text');
                    textarea.select();
                    document.execCommand('copy');
                    displayMessage('Copied to clipboard!', 'success');
                }

                function displayMessage(message, type) {
                    const messageContainer = document.createElement('div');
                    messageContainer.textContent = message;
                    messageContainer.classList.add('fixed', 'bottom-8', 'right-8', 'py-3', 'px-6', 'rounded-lg', 'shadow-lg', 'z-50', 'transition-opacity', 'duration-300', 'opacity-0');

                    if (type === 'success') {
                        messageContainer.classList.add('bg-green-600', 'text-white');
                    } else if (type === 'error') {
                        messageContainer.classList.add('bg-red-600', 'text-white');
                    }

                    document.body.appendChild(messageContainer);
                    setTimeout(() => messageContainer.classList.add('opacity-100'), 100);
                    setTimeout(() => messageContainer.remove(), 3000);
                }
            });
        </script>
</body>

</html>